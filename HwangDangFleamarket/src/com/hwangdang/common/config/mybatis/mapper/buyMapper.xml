<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="buy">

     
<sql id="product-column">
	product_id , product_name ,product_price ,product_stock ,
	product_main_image  , product_info , product_like , seller_store_no
</sql>

<sql id="seller-column">
	seller_store_no , seller_store_name , seller_tax_id , seller_industry ,
	seller_sub_industry , seller_zipcode , seller_address , selelr_sub_address ,
	seller_sub_address , seller_store_image , seller_product1,seller_store_image , seller_product2,
	seller_store_image , seller_product3 , seller_introduction , member_id AS 'seller'

</sql>

	<sql id="orders-column">
		orders_no, orders_receiver, orders_phone, orders_zipcode, orders_address, orders_sub_address,
		orders_total_price, orders_payment,orders_request, payment_status, member_id ,orders_date
	</sql>

<resultMap type="product" id="basic-productmap">

	<id column="product_id" property="productId" />
	<result column="product_name" property="productName"/>
	<result column="product_price" property="productPrice"/>
	<result column="product_stock" property="productStock"/>
	<result column="product_main_image" property="productMainImage"/>
	<result column="product_info" property="productInfo"/>
	<result column="product_like" property="productLike"/>
	<result column="seller_store_no" property="sellerStoreNo"/>
</resultMap>


<resultMap type="ProductOption" id="basic-productOption-resultmap">
	<id column="option_id" property="optionId" />
	<result column="option_name" property="optionName"/>
	<result column="option_sub_name" property="optionSubName" />
	<result column="product_id" property="productId"/>
	<result column="option_stock" property="optionStock"/>
	<result column="option_add_price" property="optionAddPrice"/>
	
</resultMap>

<!-- 주문 기본 리절트맵 -->
	<resultMap type="orders" id="orders-basic-resultmap">
		<id column="orders_no" property="ordersNo"/>
		<result column="orders_receiver" property="ordersReceiver"/>
		<result column="orders_phone" property="ordersPhone"/>
		<result column="orders_zipcode" property="ordersZipcode"/>
		<result column="orders_address" property="ordersAddress"/>
		<result column="orders_sub_address" property="ordersSubAddress"/>
		<result column="orders_total_price" property="ordersTotalPrice"/>
		<result column="orders_payment" property="ordersPayment"/>
		<result column="orders_request" property="ordersRequest"/>
		<result column="payment_status" property="paymentStatus"/>
		<result column="member_id" property="memberId"/>
		<result column="orders_date"  property="orders_date"/>
	</resultMap>


<!-- 재고량 조회 -->
<select id="product-stock-by-productId" parameterType="string" resultType="_int">

SELECT product_stock 
FROM   product
WHERE product_id = #{productId} 

</select>

<!-- 
	orders TB INSERT
 -->
<insert id="insert-orders" parameterType="orders">
INSERT INTO orders 

VALUES ( 
 #{ordersNo },#{ordersReceiver },#{ordersPhone },#{ordersZipcode },
 #{ordersAddress },#{ordersSubAddress },#{ordersTotalPrice },#{ordersPayment },
 #{ordersRequest },#{paymentStatus },#{orders_date },#{memberId }
 
)
</insert>

<!-- order_product TB INSERT   -->
<insert id="insert-order-product" parameterType="OrderProduct">
<selectKey order="BEFORE" keyProperty="orderSeqNo" resultType="_int" >
	SELECT  order_product_seq.nextval
	FROM dual
</selectKey>
INSERT INTO order_product
VALUES ( 
 #{orderSeqNo },#{orderAmount }, #{ordersNo }, #{productId },
 #{optionId }, #{sellerStoreNo },#{orderProductStatus }
 
)
</insert>

<select id="select-product-by-productId" parameterType="string" resultMap="basic-productmap">
SELECT <include refid="product-column"/>
FROM   product
WHERE  product_id = #{productId} 
	
</select>


<select id="select-product-option-by-like" resultMap="basic-productOption-resultmap" parameterType="string">

SELECT  	option_id , option_name , option_sub_name ,
			product_id , option_stock , option_add_price
			
FROM 		product_option
WHERE 		option_sub_name = #{optionName } 
</select>


<select id="select-seller-by-seller-store-no" parameterType="_int" resultType="string">
	SELECT seller_store_name  
	FROM   seller
	WHERE  seller_store_no = #{value}
</select>

<select id="select-orders-by-date" parameterType="string" resultMap="orders-basic-resultmap">
SELECT <include refid="orders-column"/>
FROM orders  
WHERE orders_date = 
(  
	SELECT MAX(orders_date) FROM orders WHERE member_id =  #{memberId}  
)    
</select>


<select id="select-orders-by-ordersNo" parameterType="string" resultMap="orders-basic-resultmap">
SELECT <include refid="orders-column"/>
FROM orders  
WHERE orders_no = #{ordersNo} 

</select>


</mapper>